angular.module("starter",["ionic","ngMaterial"]).run(["$ionicPlatform","$rootScope","$state",function(e,o,n){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault(),firebase.auth().onAuthStateChanged(function(e){o.fbUser=firebase.auth().currentUser,null!=o.fbUser?(o.isLoggedIn=!0,console.log("loggedIN"),n.go("home")):(o.isLoggedIn=!1,console.log("loggedOUT"),n.go("auth"))})})}]).config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(e,o,n){n.views.transition("none"),e.state("auth",{url:"/auth",templateUrl:"templates/auth.html",controller:"authCtrl"}).state("profile",{url:"/profile",templateUrl:"templates/profile.html",controller:"profileCtrl"}).state("home",{url:"/home",templateUrl:"templates/home.html",controller:"homeCtrl"}),o.otherwise("/home")}]),angular.module("starter").controller("authCtrl",["$scope","$mdToast",function(e,o){e.showSignIn=!1,e.signUp=function(e){firebase.auth().createUserWithEmailAndPassword(e.email,e.password).then(function(o){firebase.database().ref("users/"+o.uid).update({name:e.name,username:e.username,status:"online",email:e.email}),console.log(e)}).catch(function(e){var n=e.code,t=e.message;o.show(o.simple().textContent("Error "+n+": "+t).hideDelay(3e3))})},e.signIn=function(e){firebase.auth().signInWithEmailAndPassword(e.email,e.password).then(function(e){firebase.database().ref("users/"+e.uid).update({status:"online"})}).catch(function(e){var n=e.code,t=e.message;o.show(o.simple().textContent("Error "+n+": "+t).hideDelay(3e3))}),console.log("sign in")},e.switch=function(){0==e.showSignIn?e.showSignIn=!0:1==e.showSignIn&&(e.showSignIn=!1),console.log(e.showSignIn)}}]),angular.module("starter").controller("homeCtrl",["$scope","$timeout","$state",function(e,o,n){e.movies=[],e.getMovies=function(){firebase.database().ref("movies").once("value").then(function(o){o.forEach(function(o){firebase.storage().ref("images/"+o.val().poster).getDownloadURL().then(function(n){e.movies.push({name:o.val().name,year:o.val().year,poster:n}),e.$applyAsync()})})})},e.movieChosen=function(e){console.log(e)}}]),angular.module("starter").controller("navCtrl",["$scope","$timeout","$state",function(e,o,n){e.title="Synchronized Video Streaming",e.signOut=function(){firebase.auth().signOut().then(function(){},function(e){})},e.goToProfile=function(){n.go("profile")},e.ETgoHome=function(){n.go("home")}}]),angular.module("starter").controller("profileCtrl",["$scope","$mdToast","$state","$rootScope",function(e,o,n,t){e.friendIds=[],e.friends=[],e.getProfileInfo=function(){firebase.database().ref("users/"+t.fbUser.uid).once("value").then(function(o){e.user=o.val(),console.log(e.user),console.log(e.friendIds),e.user.phone||(e.user.phone="")}),firebase.database().ref("users/"+t.fbUser.uid+"/friends").once("value").then(function(o){o.forEach(function(o){e.friendIds.push(o.key)}),e.friendIds.forEach(function(o){console.log("FRIEND: "+o),firebase.database().ref("users/"+o).once("value").then(function(o){e.friends.push({name:o.val().name,status:o.val().status}),e.$applyAsync()})}),console.log(e.friends)})},e.updateProfile=function(){firebase.database().ref("users/"+t.fbUser.uid).update({name:e.user.name,phone:e.user.phone,email:t.fbUser.email,username:e.user.username},function(e){var n;n=e?"Error "+errorCode+": "+errorMessage:"Profile Updated",o.show(o.simple().textContent(n).hideDelay(3e3))})}}]);